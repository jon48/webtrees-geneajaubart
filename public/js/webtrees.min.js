"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}!function(e){var t=document.documentElement.lang,a={Han:/[\u3400-\u9FCC]/,Grek:/[\u0370-\u03FF]/,Cyrl:/[\u0400-\u04FF]/,Hebr:/[\u0590-\u05FF]/,Arab:/[\u0600-\u06FF]/};function o(e){return e.replace(/\s+/g," ").trim()}e.detectScript=function(e){for(var t in a)if(e.match(a[t]))return t;return"Latn"},e.buildNameFromParts=function(a,n,i,r,s,l){var c="Han"===e.detectScript(a+n+i+n+r+s),d=c?"":" ",u=c||-1!==["hu","jp","ko","vi","zh-Hans","zh-Hant"].indexOf(t),p=-1!==["is"].indexOf(t)?"":"/";a=o(a),n=o(n.replace(/,/g,d)),i=o(i),r=function(e,a){return"pl"===t&&"F"===a?e.replace(/ski$/,"ska").replace(/cki$/,"cka").replace(/dzki$/,"dzka").replace(/żki$/,"żka"):e}(o(r.replace(/,/g,d)),l),s=o(s);var g=o(i+d+r);return o(a+d+(u?p+g+p+d+n:n+d+p+g+p)+d+s)},e.pasteAtCursor=function(e,t){if(null!==e){var a=e.selectionStart+t.length,o=e.value.substring(0,e.selectionStart),n=e.value.substring(e.selectionEnd);e.value=o+t+n,e.setSelectionRange(a,a),e.focus()}},e.reformatDate=function(e,t){var a=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],o=e.value,n=o.split("("),i="";n.length>1&&(o=n[0],i=n[1]),(o=(o=(o=(o=(o=o.toUpperCase()).replace(/\s+/g," ")).replace(/(^\s)|(\s$)/,"")).replace(/(\d)([A-Z])/g,"$1 $2")).replace(/([A-Z])(\d)/g,"$1 $2")).match(/^Q ([1-4]) (\d\d\d\d)$/)&&(o="BET "+a[3*RegExp.$1-3]+" "+RegExp.$2+" AND "+a[3*RegExp.$1-1]+" "+RegExp.$2),o.match(/^(@#DHIJRI@|HIJRI)( \d?\d )(\d?\d)( \d?\d?\d?\d)$/)&&(o="@#DHIJRI@"+RegExp.$2+["MUHAR","SAFAR","RABIA","RABIT","JUMAA","JUMAT","RAJAB","SHAAB","RAMAD","SHAWW","DHUAQ","DHUAH"][parseInt(RegExp.$3,10)-1]+RegExp.$4),o.match(/^(@#DJALALI@|JALALI)( \d?\d )(\d?\d)( \d?\d?\d?\d)$/)&&(o="@#DJALALI@"+RegExp.$2+["FARVA","ORDIB","KHORD","TIR","MORDA","SHAHR","MEHR","ABAN","AZAR","DEY","BAHMA","ESFAN"][parseInt(RegExp.$3,10)-1]+RegExp.$4),o.match(/^(@#DHEBREW@|HEBREW)( \d?\d )(\d?\d)( \d?\d?\d?\d)$/)&&(o="@#DHEBREW@"+RegExp.$2+["TSH","CSH","KSL","TVT","SHV","ADR","ADS","NSN","IYR","SVN","TMZ","AAV","ELL"][parseInt(RegExp.$3,10)-1]+RegExp.$4),o.match(/^(@#DFRENCH R@|FRENCH)( \d?\d )(\d?\d)( \d?\d?\d?\d)$/)&&(o="@#DFRENCH R@"+RegExp.$2+["VEND","BRUM","FRIM","NIVO","PLUV","VENT","GERM","FLOR","PRAI","MESS","THER","FRUC","COMP"][parseInt(RegExp.$3,10)-1]+RegExp.$4),o=(o=(o=o.replace(/(\d\d)(\d\d)(\d\d)(\d\d)/g,function(){return RegExp.$1>"12"&&RegExp.$3<="12"&&RegExp.$4<="31"?RegExp.$4+" "+a[RegExp.$3-1]+" "+RegExp.$1+RegExp.$2:RegExp.$1<="31"&&RegExp.$2<="12"&&RegExp.$3>"12"?RegExp.$1+" "+a[RegExp.$2-1]+" "+RegExp.$3+RegExp.$4:RegExp.$1+RegExp.$2+RegExp.$3+RegExp.$4})).replace(/(\d+)([ ./-])(\d+)(\2)(\d+)/g,function(){var e=parseInt(RegExp.$1,10),o=parseInt(RegExp.$3,10),n=parseInt(RegExp.$5,10),i=(new Date).getFullYear(),r=i%100,s=i-r;return("DMY"===t||e>13&&n>31)&&e<=31&&o<=12?e+" "+a[o-1]+" "+(n>=100?n:n<=r?n+s:n+s-100):("MDY"===t||o>13&&n>31)&&e<=12&&o<=31?o+" "+a[e-1]+" "+(n>=100?n:n<=r?n+s:n+s-100):("YMD"===t||e>31)&&o<=12&&n<=31?n+" "+a[o-1]+" "+(e>=100?e:e<=r?e+s:e+s-100):RegExp.$1+RegExp.$2+RegExp.$3+RegExp.$4+RegExp.$5})).replace(/^[>]([\w ]+)$/,"AFT $1").replace(/^[<]([\w ]+)$/,"BEF $1").replace(/^([\w ]+)[-]$/,"FROM $1").replace(/^[-]([\w ]+)$/,"TO $1").replace(/^[~]([\w ]+)$/,"ABT $1").replace(/^[*]([\w ]+)$/,"EST $1").replace(/^[#]([\w ]+)$/,"CAL $1").replace(/^([\w ]+) ?- ?([\w ]+)$/,"BET $1 AND $2").replace(/^([\w ]+) ?~ ?([\w ]+)$/,"FROM $1 TO $2").replace(/JANUARY/g,"JAN").replace(/FEBRUARY/g,"FEB").replace(/MARCH/g,"MAR").replace(/APRIL/g,"APR").replace(/JUNE/g,"JUN").replace(/JULY/g,"JUL").replace(/AUGUST/g,"AUG").replace(/SEPTEMBER/g,"SEP").replace(/OCTOBER/,"OCT").replace(/NOVEMBER/g,"NOV").replace(/DECEMBER/g,"DEC").replace(/(JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC)\.? (\d\d?)[, ]+(\d\d\d\d)/g,"$2 $1 $3").replace(/(^| )(\d [A-Z]{3,5} \d{4})/g,"$10$2"),i&&(o=o+" ("+i),e.value!==o&&(e.value=o)};var n=[];n[1]="January",n[2]="February",n[3]="March",n[4]="April",n[5]="May",n[6]="June",n[7]="July",n[8]="August",n[9]="September",n[10]="October",n[11]="November",n[12]="December";var i=[];i[1]="JAN",i[2]="FEB",i[3]="MAR",i[4]="APR",i[5]="MAY",i[6]="JUN",i[7]="JUL",i[8]="AUG",i[9]="SEP",i[10]="OCT",i[11]="NOV",i[12]="DEC";var r=[];r[0]="S",r[1]="M",r[2]="T",r[3]="W",r[4]="T",r[5]="F",r[6]="S";var s=0;function l(e,t,a){var o,i,l='<table border="1"><tr>';for(l+='<td><select class="form-control" id="'+e+'_daySelect" onchange="return webtrees.calUpdateCalendar(\''+e+"', '"+t+"');\">",o=1;o<32;o++)l+='<option value="'+o+'"',a.getDate()===o&&(l+=' selected="selected"'),l+=">"+o+"</option>";for(l+="</select></td>",l+='<td><select class="form-control" id="'+e+'_monSelect" onchange="return webtrees.calUpdateCalendar(\''+e+"', '"+t+"');\">",o=1;o<13;o++)l+='<option value="'+o+'"',a.getMonth()+1===o&&(l+=' selected="selected"'),l+=">"+n[o]+"</option>";for(l+="</select></td>",l+='<td><input class="form-control" type="text" id="'+e+'_yearInput" size="5" value="'+a.getFullYear()+'" onchange="return webtrees.calUpdateCalendar(\''+e+"', '"+t+"');\" /></td></tr>",l+='<tr><td colspan="3">',l+='<table width="100%">',l+="<tr>",i=s,o=0;o<7;o++)l+="<td ",l+='class="descriptionbox"',l+=">",l+=r[i],l+="</td>",++i>6&&(i=0);l+="</tr>";var c=new Date(a.getFullYear(),a.getMonth(),1),d=c.getDay();d-=s;for(c=c.getTime()-864e5*d+432e5,c=new Date(c),i=0;i<6;i++){for(l+="<tr>",o=0;o<7;o++){l+="<td ",c.getMonth()===a.getMonth()?c.getDate()===a.getDate()?l+='class="descriptionbox"':l+='class="optionbox"':l+='style="background-color:#EAEAEA; border: solid #AAAAAA 1px;"',l+='><a href="#" onclick="return webtrees.calDateClicked(\''+e+"', '"+t+"', "+c.getFullYear()+", "+c.getMonth()+", "+c.getDate()+');">',l+=c.getDate(),l+="</a></td>";var u=c.getTime()+864e5;c=new Date(u)}l+="</tr>"}return l+="</table>",l+="</td></tr>",l+="</table>"}function c(e,t,a,o){return document.getElementById(e).value=(o<10?"0":"")+o+" "+i[a+1]+" "+t,!1}function d(e,t,a){var o=e.value.toUpperCase();(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=o.replace(/(^\s*)|(\s*$)/g,"")).replace(/ /g,":")).replace(/\+/g,"")).replace(/-/g,a)).replace(/,/g,".")).replace(/\u00b0/g,":")).replace(/\u0027/g,":")).replace(/^([0-9]+):([0-9]+):([0-9.]+)(.*)/g,function(e,t,a,o,n){var i=parseFloat(t);return i+=a/60,i+=o/3600,n+(i=Math.round(1e4*i)/1e4)})).replace(/^([0-9]+):([0-9]+)(.*)/g,function(e,t,a,o){var n=parseFloat(t);return n+=a/60,o+(n=Math.round(1e4*n)/1e4)})).replace(/(.*)(NSEW])$/g,"$2$1"))&&o.charAt(0)!==a&&o.charAt(0)!==t&&(o=t+o),e.value=o}e.calLocalize=function(e,t,a,o,i,l,c,d,u,p,g,h,f,v,m,b,x,E,$,w){n[1]=e,n[2]=t,n[3]=a,n[4]=o,n[5]=i,n[6]=l,n[7]=c,n[8]=d,n[9]=u,n[10]=p,n[11]=g,n[12]=h,r[0]=f,r[1]=v,r[2]=m,r[3]=b,r[4]=x,r[5]=E,r[6]=$,w>=0&&w<7&&(s=w)},e.calendarWidget=function(e,t){var a=document.getElementById(e),o=document.getElementById(t);if("visible"===a.style.visibility)return a.style.visibility="hidden",!1;if("show"===a.style.visibility)return a.style.visibility="hide",!1;var n;if(/(?:(\d*) ?(JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC) )?(\d+)/i.exec(o.value)){var i=RegExp.$1||"1",r=RegExp.$2||"JAN",s=RegExp.$3;n=new Date(i+" "+r+" "+s)}else n=new Date;return a.innerHTML=l(t,e,n),"hidden"===a.style.visibility?(a.style.visibility="visible",!1):"hide"===a.style.visibility&&(a.style.visibility="show",!1)},e.calUpdateCalendar=function(e,t){var a=document.getElementById(e+"_daySelect");if(!a)return!1;var o=document.getElementById(e+"_monSelect");if(!o)return!1;var n=document.getElementById(e+"_yearInput");if(!n)return!1;var i=parseInt(o.options[o.selectedIndex].value,10);i-=1;var r=new Date(n.value,i,a.options[a.selectedIndex].value);c(e,r.getFullYear(),r.getMonth(),r.getDate());var s=document.getElementById(t);return s?(s.innerHTML=l(e,t,r),!1):(alert("no dateDiv "+t),!1)},e.calDateClicked=function(t,a,o,n,i){return c(t,o,n,i),e.calendarWidget(a,t),!1},e.persistentToggle=function(e){var t=document.getElementById(e),a="state-of-"+e,o=localStorage.getItem(a);t instanceof HTMLInputElement&&"checkbox"===t.type&&("true"===o&&t.click(),t.addEventListener("change",function(){localStorage.setItem(a,t.checked)}))},e.reformatLatitude=function(e){return d(e,"N","S")},e.reformatLongitude=function(e){return d(e,"E","W")},e.autocomplete=function(e){$(e).each(function(){var e=this;$(this).typeahead(null,{display:"value",limit:10,minLength:2,source:new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:this.dataset.autocompleteUrl,replace:function(t,a){if("SOUR"===e.dataset.autocompleteExtra){var o=e.closest(".form-group").previousElementSibling.querySelector("select"),n=o.options[o.selectedIndex].value;return t.replace(/(%7B|{)query(%7D|})/,a)+"?extra="+encodeURIComponent(n)}return t.replace(/(%7B|{)query(%7D|})/,a)},wildcard:"{query}"}})})})}}(window.webtrees=window.webtrees||{}),$.ajaxSetup({headers:{"X-CSRF-TOKEN":$("meta[name=csrf]").attr("content")}}),$(function(){$("[data-ajax-url]").each(function(){$(this).load($(this).data("ajaxUrl"))}),webtrees.autocomplete("input[data-autocomplete-url]");var e,t=document.documentElement.lang;$("select.select2").select2({language:{"zh-Hans":"zh-CN","zh-Hant":"zh-TW"}[t]||t,width:"100%",escapeMarkup:function(e){return e}}),$("select.select2:not([multiple])").on("select2:unselect",function(e){$(e.delegateTarget).html('<option value="" selected></option>')}),$.fn.dataTableExt.oSort["text-asc"]=function(e,t){return e.localeCompare(t,document.documentElement.lang,{sensitivity:"base"})},$.fn.dataTableExt.oSort["text-desc"]=function(e,t){return t.localeCompare(e,document.documentElement.lang,{sensitivity:"base"})},$("table.datatables").each(function(){$(this).DataTable(),$(this).removeClass("d-none")}),document.querySelectorAll("[data-toggle=button][data-persist]").forEach(function(e){"T"===localStorage.getItem("state-of-"+e.dataset.persist)&&e.click(),e.addEventListener("click",function(e){localStorage.setItem("state-of-"+e.target.dataset.persist,e.target.classList.contains("active")?"F":"T")})}),$(".wt-osk-trigger").click(function(){(e=document.getElementById($(this).data("id"))).focus(),$(".wt-osk").show()}),$(".wt-osk-script-button").change(function(){$(".wt-osk-script").prop("hidden",!0),$(".wt-osk-script-"+$(this).data("script")).prop("hidden",!1)}),$(".wt-osk-shift-button").click(function(){document.querySelector(".wt-osk-keys").classList.toggle("shifted")}),$(".wt-osk-keys").on("click",".wt-osk-key",function(){var t=$(this).contents().get(0).nodeValue,a=$(".wt-osk-shift-button").hasClass("active"),o=$("sup",this)[0];a&&void 0!==o&&(t=o.innerText),webtrees.pasteAtCursor(e,t),!1===$(".wt-osk-pin-button").hasClass("active")&&$(".wt-osk").hide()}),$(".wt-osk-close").on("click",function(){$(".wt-osk").hide()})}),document.addEventListener("click",function(e){var t=e.target.closest("a,button");if(null!==t)if("confirm"in t.dataset&&!confirm(t.dataset.confirm))e.preventDefault();else if("postUrl"in t.dataset){var a=document.querySelector("meta[name=csrf]").content;fetch(t.dataset.postUrl,{method:"POST",headers:{"X-CSRF-TOKEN":a,"X-Requested-with":"XMLHttpRequest"}}).then(function(){"reloadUrl"in t.dataset?document.location=t.dataset.reloadUrl:document.location.reload()}).catch(function(e){alert(e)})}});var GOOGLE_CHARTS_LIB="https://www.gstatic.com/charts/loader.js",Statistics=function(){function e(){return _classCallCheck(this,e),e.instance||(e.instance=this,this.callbacks=[],this.initialized=!1,this.loading=!1),e.instance}return _createClass(e,[{key:"init",value:function(e){if(!this.loading&&!this.initialized){var t=this;Promise.all([this.load(GOOGLE_CHARTS_LIB)]).then(function(){google.charts.load("current",{packages:["corechart","geochart","bar"],language:e,mapsApiKey:""}),google.charts.setOnLoadCallback(function(){t.callbacks.forEach(function(e){e()})}),t.initialized=!0}).catch(function(e){console.log(e)})}}},{key:"load",value:function(e){if(!this.loading)return this.loading=!0,new Promise(function(t,a){var o=document.createElement("script");o.async=!0,o.onload=function(){t(e)},o.onerror=function(){a(e)},o.src=e,document.body.appendChild(o)})}},{key:"addCallback",value:function(e){this.initialized?google.charts.setOnLoadCallback(e):this.callbacks.push(e),$(window).resize(function(){e()})}},{key:"drawChart",value:function(e,t,a,o){var n=google.visualization.arrayToDataTable(a);new google.visualization.ChartWrapper({chartType:t,dataTable:n,options:o,containerId:e}).draw()}},{key:"drawPieChart",value:function(e,t,a){a=Object.assign({title:"",height:"100%",width:"100%",pieStartAngle:0,pieSliceText:"none",pieSliceTextStyle:{color:"#777"},pieHole:.4,legend:{alignment:"center",labeledValueText:"value",position:"labeled"},chartArea:{left:0,top:"5%",height:"90%",width:"100%"},tooltip:{trigger:"none",text:"both"},backgroundColor:"transparent",colors:[]},a),this.drawChart(e,"PieChart",t,a)}},{key:"drawColumnChart",value:function(e,t,a){a=Object.assign({title:"",subtitle:"",titleTextStyle:{color:"#757575",fontName:"Roboto",fontSize:"16px",bold:!1,italic:!1},height:"100%",width:"100%",vAxis:{title:""},hAxis:{title:""},legend:{position:"none"},backgroundColor:"transparent"},a),this.drawChart(e,"ColumnChart",t,a)}},{key:"drawComboChart",value:function(e,t,a){a=Object.assign({title:"",subtitle:"",titleTextStyle:{color:"#757575",fontName:"Roboto",fontSize:"16px",bold:!1,italic:!1},height:"100%",width:"100%",vAxis:{title:""},hAxis:{title:""},legend:{position:"none"},seriesType:"bars",series:{2:{type:"line"}},colors:[],backgroundColor:"transparent"},a),this.drawChart(e,"ComboChart",t,a)}},{key:"drawGeoChart",value:function(e,t,a){a=Object.assign({title:"",subtitle:"",height:"100%",width:"100%"},a),this.drawChart(e,"GeoChart",t,a)}}]),e}(),statistics=new Statistics;function TreeViewHandler(e,t){var a,o,n,i=this;this.treeview=$("#"+e+"_in"),this.loadingImage=$("#"+e+"_loading"),this.toolbox=$("#tv_tools"),this.buttons=$(".tv_button:first",this.toolbox),this.zoom=100,this.boxWidth=180,this.boxExpandedWidth=250,this.cookieDays=3,this.ajaxDetails=document.getElementById(e+"_out").dataset.urlDetails+"&instance="+encodeURIComponent(e),this.ajaxPersons=document.getElementById(e+"_out").dataset.urlIndividuals+"&instance="+encodeURIComponent(e),this.container=this.treeview.parent(),this.auto_box_width=!1,this.updating=!1,"true"===readCookie("compact")&&i.compact(),n=!1,i.treeview.on("mousedown touchstart",function(e){e.preventDefault();var t="touchstart"===e.type?e.touches[0].pageX:e.pageX,r="touchstart"===e.type?e.touches[0].pageY:e.pageY;a=i.treeview.offset().left-t,o=i.treeview.offset().top-r,n=!0}),$(document).on("mousemove touchmove",function(e){if(n){e.preventDefault();var t="touchmove"===e.type?e.touches[0].pageX:e.pageX,r="touchmove"===e.type?e.touches[0].pageY:e.pageY;i.treeview.offset({left:t+a,top:r+o})}}),$(document).on("mouseup touchend",function(e){n&&(e.preventDefault(),n=!1,i.updateTree())}),i.toolbox.find("#tvbCompact").each(function(e,t){t.onclick=function(){i.compact()}}),i.toolbox.find("#tvbAllPartners").each(function(e,t){t.onclick=function(){createCookie("allPartners","true"===readCookie("allPartners")?"false":"true",i.cookieDays),document.location=document.location}}),i.toolbox.find("#tvbOpen").each(function(e,t){var a=$(t,i.toolbox);t.onclick=function(){a.addClass("tvPressed"),i.setLoading();var e=jQuery.Event("click");i.treeview.find(".tv_box:not(.boxExpanded)").each(function(t,a){var o=$(a,i.treeview).offset();o.left>=i.leftMin&&o.left<=i.leftMax&&o.top>=i.topMin&&o.top<=i.topMax&&i.expandBox(a,e)}),a.removeClass("tvPressed"),i.setComplete()}}),i.toolbox.find("#tvbClose").each(function(e,t){var a=$(t,i.toolbox);t.onclick=function(){a.addClass("tvPressed"),i.setLoading(),i.treeview.find(".tv_box.boxExpanded").each(function(e,t){$(t).css("display","none").removeClass("boxExpanded").parent().find(".tv_box.collapsedContent").css("display","block")}),a.removeClass("tvPressed"),i.setComplete()}}),i.centerOnRoot()}function createCookie(e,t,a){if(a){var o=new Date;o.setTime(o.getTime()+24*a*60*60*1e3),document.cookie=e+"="+t+"; expires="+o.toGMTString()+"; path=/"}else document.cookie=e+"="+t+"; path=/"}function readCookie(e){for(var t=e+"=",a=document.cookie.split(";"),o=0;o<a.length;o++){for(var n=a[o];" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(t))return n.substring(t.length,n.length)}return null}TreeViewHandler.prototype.setLoading=function(){this.treeview.css("cursor","wait"),this.loadingImage.css("display","block")},TreeViewHandler.prototype.setComplete=function(){this.treeview.css("cursor","move"),this.loadingImage.css("display","none")},TreeViewHandler.prototype.getSize=function(){var e=this,t=e.container.parent(),a=t.offset();e.leftMin=a.left,e.leftMax=e.leftMin+t.innerWidth(),e.topMin=a.top,e.topMax=e.topMin+t.innerHeight()},TreeViewHandler.prototype.updateTree=function(e,t){var a=this,o=[],n=[];return this.getSize(),a.treeview.find("td[abbr]").each(function(e,t){var i=(t=$(t,a.treeview)).offset();i.left>=a.leftMin&&i.left<=a.leftMax&&i.top>=a.topMin&&i.top<=a.topMax&&(o.push(t.attr("abbr")),n.push(t))}),o.length>0?(a.updating=!0,a.setLoading(),jQuery.ajax({url:a.ajaxPersons,dataType:"json",data:"q="+o.join(";"),success:function(e){for(var t=n.length,o=($(".rootPerson",this.treeview).offset().left,0);o<t;o++)n[o].removeAttr("abbr").html(e[o]);a.getSize()},complete:function(){a.treeview.find("td[abbr]").length&&a.updateTree(e,t),a.auto_box_width&&a.treeview.find(".tv_box").css("width","auto"),a.updating=!0,e&&a.centerOnRoot(),t&&t.removeClass("tvPressed"),a.setComplete(),a.updating=!1},timeout:function(){t&&t.removeClass("tvPressed"),a.updating=!1,a.setComplete()}})):(t&&t.removeClass("tvPressed"),a.setComplete()),!1},TreeViewHandler.prototype.compact=function(){var e=this,t=$("#tvbCompact",e.toolbox);if(e.setLoading(),e.auto_box_width){var a=e.boxWidth*(e.zoom/100)+"px",o=e.boxExpandedWidth*(e.zoom/100)+"px";e.treeview.find(".tv_box:not(boxExpanded)",e.treeview).css("width",a),e.treeview.find(".boxExpanded",e.treeview).css("width",o),e.auto_box_width=!1,readCookie("compact")&&createCookie("compact",!1,e.cookieDays),t.removeClass("tvPressed")}else e.treeview.find(".tv_box").css("width","auto"),e.auto_box_width=!0,readCookie("compact")||createCookie("compact",!0,e.cookieDays),e.updating||e.updateTree(),t.addClass("tvPressed");return e.setComplete(),!1},TreeViewHandler.prototype.centerOnRoot=function(){this.loadingImage.css("display","block");var e=this.container,t=e.innerWidth()/2;if(Number.isNaN(t))return!1;e.innerHeight(),$(".rootPerson",this.treeview);return this.updating||this.setComplete(),!1},TreeViewHandler.prototype.expandBox=function(e,t){if($(t.target).hasClass("tv_link"))return!1;var a,o,n=(e=$(e,this.treeview)).parent(),i=e.attr("abbr"),r=this;if(n.hasClass("detailsLoaded"))o=n.find(".collapsedContent"),a=n.find(".tv_box:not(.collapsedContent)");else{a=e,o=e.clone(),n.append(o.addClass("collapsedContent").css("display","none"));var s=this.loadingImage.find("img").clone().addClass("tv_box_loading").css("display","block");e.prepend(s),r.updating=!0,r.setLoading(),e.load(r.ajaxDetails+"&pid="+encodeURIComponent(i),function(){"function"==typeof CB_Init&&CB_Init(),e.css("width",r.boxExpandedWidth*(r.zoom/100)+"px"),s.remove(),n.addClass("detailsLoaded"),r.setComplete(),r.updating=!1})}return e.hasClass("boxExpanded")?(a.css("display","none"),o.css("display","block"),e.removeClass("boxExpanded")):(a.css("display","block"),o.css("display","none"),a.addClass("boxExpanded")),this.getSize(),!1};
