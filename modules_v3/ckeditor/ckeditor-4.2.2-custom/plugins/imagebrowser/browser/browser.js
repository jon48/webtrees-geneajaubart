var CkEditorImageBrowser={folders:[],images:{},ckFunctionNum:null,$folderSwitcher:null,$imagesContainer:null,init:function(){CkEditorImageBrowser.$folderSwitcher=$("#js-folder-switcher");CkEditorImageBrowser.$imagesContainer=$("#js-images-container");var b=CkEditorImageBrowser.getQueryStringParam("baseHref");if(b){var d=document.head||document.getElementsByTagName("head")[0];d.getElementsByTagName("link")[0].href=location.href.replace(/\/[^\/]*$/,"/browser.css");d.getElementsByTagName("base")[0].href=b}CkEditorImageBrowser.ckFunctionNum=CkEditorImageBrowser.getQueryStringParam("CKEditorFuncNum");CkEditorImageBrowser.initEventHandlers();CkEditorImageBrowser.loadData(CkEditorImageBrowser.getQueryStringParam("listUrl"),function(){CkEditorImageBrowser.initFolderSwitcher()})},loadData:function(b,d){CkEditorImageBrowser.folders=[];CkEditorImageBrowser.images={};$.getJSON(b,function(c){$.each(c,function(f,e){"undefined"===typeof e.folder&&(e.folder="Images");"undefined"===typeof e.thumb&&(e.thumb=e.image);CkEditorImageBrowser.addImage(e.folder,e.image,e.thumb)});d()}).error(function(f,e,a){CkEditorImageBrowser.$imagesContainer.html(200>f.status||400<=f.status?"HTTP Status: "+f.status+"/"+f.statusText+': "<strong style="color: red;">'+b+'</strong>"':"parsererror"===e?e+': invalid JSON file: "<strong style="color: red;">'+b+'</strong>": '+a.message:e+" / "+f.statusText+" / "+a.message)})},addImage:function(b,f,d){"undefined"===typeof CkEditorImageBrowser.images[b]&&(CkEditorImageBrowser.folders.push(b),CkEditorImageBrowser.images[b]=[]);CkEditorImageBrowser.images[b].push({imageUrl:f,thumbUrl:d})},initFolderSwitcher:function(){var b=CkEditorImageBrowser.$folderSwitcher;b.find("li").remove();$.each(CkEditorImageBrowser.folders,function(d,a){$("<li></li>").data("idx",d).text(a).appendTo(b)});0===CkEditorImageBrowser.folders.length?(b.remove(),CkEditorImageBrowser.$imagesContainer.text("No images.")):(1===CkEditorImageBrowser.folders.length&&b.hide(),b.find("li:first").click())},renderImagesForFolder:function(b){b=CkEditorImageBrowser.images[b];var d=$("#js-template-image").html();CkEditorImageBrowser.$imagesContainer.html("");$.each(b,function(e,f){var c=d,c=c.replace("%imageUrl%",f.imageUrl),c=c.replace("%thumbUrl%",f.thumbUrl),c=$($.parseHTML(c));CkEditorImageBrowser.$imagesContainer.append(c)})},initEventHandlers:function(){$(document).on("click","#js-folder-switcher li",function(){var b=parseInt($(this).data("idx"),10),b=CkEditorImageBrowser.folders[b];$(this).siblings("li").removeClass("active");$(this).addClass("active");CkEditorImageBrowser.renderImagesForFolder(b)});$(document).on("click",".js-image-link",function(){window.opener.CKEDITOR.tools.callFunction(CkEditorImageBrowser.ckFunctionNum,$(this).data("url"));window.close()})},getQueryStringParam:function(b){return(b=window.location.search.match(RegExp("[?&]"+b+"=([^&]*)")))&&1<b.length?decodeURIComponent(b[1]):null}};